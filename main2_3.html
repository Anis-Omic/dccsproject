<!DOCTYPE HTML>
<html>
<head>
<title>A Web Page</title>
<meta charset="UTF-8">
</head>
<style>
#body{
	background-image: url("https://images4.alphacoders.com/242/242286.jpg");
	background-repeat: no-repeat;
	background-attachment: fixed; 
	background-size: cover;
}

.tab {
    	overflow: hidden;
	margin-left: 25px;
}

/* Style the buttons that are used to open the tab content */
.tab button {
    	background-color: #808080;
    	float: left;
    	border: 1px solid #000;
	border-top-right-radius: 25px 50px;
    	outline: none;
    	cursor: pointer;
    	padding: 14px 16px;
    	transition: 0.3s;
}

/* Change background color of buttons on hover */
.tab button:hover {
    background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
	background-color: #fff;
	border-bottom: none;
}

/* Style the tab content */
.tabcontent {
    	display: none;
	height: 800px;
	text-align: center;
    	padding: 6px 12px;
	margin-top: -2px;
   	border: 1px solid #000;
}
.label{
	margin-left: 10px;
	margin-right: 20px;
	margin-top: 5px;
}

.inputtype{
	margin-left: 10px;
	margin-right: 20px;
	margin-top: 5px;
}

.radiobuttonsnumber{
	display: none;
	margin-left: 5px;
	margin-right: 5px;
}
.buttonsvalues{
	display: none;
	/*margin-left: 40%;*/
	margin-top: 25px;
	margin-bottom: 5px;
	}
	
#newdivbutton{
	display: inline;
	font-size: large;
	border: 1px solid #000;
	border-radius: 25px;
}
#adminsearch{
	margin: 20px;
}
#formularsearch{
	margin: 20px;
}

#adminbody{
	display: none;
	margin-left: 30px;
}
#formularbody{
	display: none;
	margin-top: 30px
}
#savebutton{
	display: none;
	float: right;
	margin-right: 75px;
}
#buttonsave{
	//display: none;
	float: right;
	margin-right: 75px;
}
#updatebutton{
	display: none;
	float: right;
	margin-right: 75px;
}
</style>

<body id="body">

<script>
	var formular=[
        {name:"Some existing formular"},                                
       	{rb: 1, label: "Label1", inputtype:"Textbox", ifrb: null, requirment: "Mandatory"},    
       	{rb: 2, label: "Label2", inputtype:"Textbox", ifrb: null, requirment: "None"},
       	{rb: 3, label: "Label3", inputtype:"Checkbox", ifrb: null, requirment: "None"},
		{rb: 4, label: "Label4", inputtype:"Textbox", ifrb: null, requirment: "Numeric"},
       	{rb: 5, label: "Label5", inputtype:"Radiobuttons", ifrb: null, requirment: "Mandatory"},
       	{rb: 6, label: "Label6", inputtype:"Textbox", ifrb: null, requirment: "None"}
	];
	var rblabels=["radio lb1", "radio lb2", "Radio lb3"];
	formular[5].ifrb=rblabels;
	var adminbase = [formular];
	
	var formular2=[
		{name:"Another one"},
        {rb: 1, label: "ALabel1", inputtype:"Textbox", ifrb: null, requirment: "Mandatory"},    
        {rb: 2, label: "ALabel2", inputtype:"Radiobuttons", ifrb: null, requirment: "None"},
        {rb: 3, label: "ALabel3", inputtype:"Checkbox", ifrb: null, requirment: "None"},
        {rb: 4, label: "ALabel4", inputtype:"Textbox", ifrb: null, requirment: "Numeric"},
        {rb: 5, label: "ALabel5", inputtype:"Textbox", ifrb: null, requirment: "Mandatory"},
    ];
	var rblabels2=["RBL1", "RBL2"];	
	formular2[2].ifrb=rblabels2;
	adminbase.push(formular2);

	//function for changing tabs
	function openTab(evt, tabName) {
		// Declare all variables
		var i, tabcontent, tablinks;
	
		// Get all elements with class="tabcontent" and hide them
		tabcontent = document.getElementsByClassName("tabcontent");
		for (i = 0; i < tabcontent.length; i++) {
			tabcontent[i].style.display = "none";
		}

		// Get all elements with class="tablinks" and remove the class "active"
		tablinks = document.getElementsByClassName("tablinks");
		for (i = 0; i < tablinks.length; i++) {
			tablinks[i].className = tablinks[i].className.replace(" active", "");
		}

		// Show the current tab, and add an "active" class to the button that opened the tab
		document.getElementById(tabName).style.display = "block";
		evt.currentTarget.className += " active";
	}   
	
	//functions for administrator tab
	
	//func that allow search formulars with pressing Enter key
	function adminsearchenter(){
		var formname = document.getElementById('formname');
		formname.addEventListener('keypress', function(event){
    		if(event.keyCode == 13){               // 13 is keyCode for Enter
				adminsearch(formname.value);
			} 
		});
	}
	
	//search database and depending of result call function for show page that will create further functionality 
	function adminsearch(searchadminbase){
		if(searchadminbase == ""){window.alert("Type something");}
		else{
			var i;
			for (i = 0; i < adminbase.length; i++){
				if(adminbase[i][0].name == searchadminbase){
					console.log("Formular exist");
					admineditformular(adminbase[i]);
					break;
				}
			}
			if(i == adminbase.length){
				adminaddformular(searchadminbase);
			}
		}
	}

	//function that change option of select with selected variable
	function selectoption(select_element, selected){
		var opts = select_element.options;
		for (var opt, j = 0; opt = opts[j]; j++) {
			if (opt.value == selected) {
				select_element.selectedIndex = j;
				break;
			}
		}
	}
	
	//for existing formular from database we call this function for print page with appropriate values
	function admineditformular(form){
		var div = document.getElementById("adminbody");
		div.innerHTML = "";
		div.style.display = "inline";
		document.getElementById("savebutton").style.display="inline";
		
		for(var i=1; i<form.length;i++){
			inputid=i;
			newdiv();
		}
		
		var l=0;
		for(var j=1; j<form.length; j++){
			var lbl=document.getElementsByClassName('label');
				lbl[j-1].value=form[j].label;
			var inptyp=document.getElementsByClassName('inputtype');
				selectoption(inptyp[j-1], form[j].inputtype);
			if(inptyp[j-1].value == "Radiobuttons"){
				var rbn=document.getElementsByClassName('radiobuttonsnumber');
					rbn[j-1].style.display="inline";
					selectoption(rbn[j-1], form[j].ifrb.length);
				var rbtnsval=document.getElementsByClassName('buttonsvalues');
					createradiolabels(rbn[j-1], Number(j));
				var rblabel=document.getElementsByClassName('rblabel');
				for(var k=0; k<form[j].ifrb.length; k++){
					rblabel[k+l].value=form[j].ifrb[k];
				}
				l=l+form[j].ifrb.length;
			}	
			var req=document.getElementsByClassName('requirment');
				selectoption(req[j-1], form[j].requirment);
		}
	}
	
	//function for creating new page layout that will allow create new formular
	function adminaddformular(formularname){
		var div=document.getElementById("adminbody");
		div.innerHTML="";
		div.style.display="inline";
		document.getElementById("savebutton").style.display="inline";
		inputid=1;
		newdiv();
	}
	
	var inputid=1; // global variable for tracking div id of every new element for formular
	//creating div with layout for formular element
	function newdiv(){
		if(inputid != 1){
			oldbutton=document.getElementById("newdivbutton");
			oldbutton.parentNode.removeChild(oldbutton);
		}
		var div=document.getElementById("adminbody");
		var elm=document.createElement("div");
				elm.id= inputid;
				elm.innerHTML=elm.innerHTML + "Element "+inputid+": ";
			var label=document.createElement("input");
				label.type="text";
				label.className="label";
				elm.appendChild(label);
			var select1 = document.createElement("select")
				select1.className="inputtype";
				select1.setAttribute("onchange", "requirment(this,"+elm.id+"), radiobuttonsnumber(this,"+elm.id+")");
				inputtypeoptions(select1);
				elm.appendChild(select1);
			var select2 = document.createElement("select");
				select2.className="radiobuttonsnumber";
				select2.setAttribute("onchange", "createradiolabels(this,"+elm.id+")");
				radiobuttonsnumberoptions(select2);
				elm.appendChild(select2);
			var select3 = document.createElement("select")
				select3.className="requirment";
				requirmentoptions(select3);
				elm.appendChild(select3);
			var newdivbutton=document.createElement("input");
				newdivbutton.id="newdivbutton";
				newdivbutton.type="submit";
				newdivbutton.value="+";
				newdivbutton.setAttribute("onClick", "newdiv(this)");
			elm.appendChild(newdivbutton);
			div.appendChild(elm);
			var buttonsvalues=document.createElement("div");
				buttonsvalues.className="buttonsvalues";
			
			div.appendChild(buttonsvalues);
			inputid++;
	}
	
	//creating options for inputtype select 
	function inputtypeoptions(element){
		var inputtype=["Textbox", "Checkbox", "Radiobuttons"];
		for (var i = 0; i < inputtype.length; i++) {
			var option = document.createElement("option");
				option.value = inputtype[i];
				option.text = inputtype[i];
				element.appendChild(option);
		}
	}
	
	//creating options for	requirment select 
	function requirmentoptions(element){
		var requirment=["None", "Mandatory", "Numeric"];
		for (var i = 0; i < requirment.length; i++) {
			var option = document.createElement("option");
				option.value = requirment[i];
				option.text = requirment[i];
				element.appendChild(option);
		}
	}
	
	//creating options for radiobuttonsnumber select 
	function radiobuttonsnumberoptions(element){
		for (var i = 1; i <= 5; i++) {
			var option = document.createElement("option");
				if(i==1){
					option.value = "";
					option.setAttribute("selected", "selected");
					option.setAttribute("disabled", "disabled");
					element.appendChild(option);
				}
				else{
					option.value = i;
					option.text = ""+i;
					element.appendChild(option);
				}
		}
	}
	
	//after choosing "Radio button" as input in input type this func will show input select for number of radio buttons
	function radiobuttonsnumber(inputtype, divid){  
		var rbn = document.getElementsByClassName("radiobuttonsnumber");
		var bv = document.getElementsByClassName("buttonsvalues");
		if(inputtype.value == "Radiobuttons"){
			rbn[divid-1].style.display= "inline";
		}
		else{
			rbn[divid-1].style.display= "none";
			bv[divid-1].style.display= "none";
		}
	}
	
	//if input type is radio buttons or checkbox input can not be numeric and we have to disable that option
	function requirment(inputtype, divid){
		var requirment=document.getElementsByClassName("requirment");
		if(inputtype.value != "Textbox"){
			requirment[divid-1].options[2].setAttribute("disabled", true);
		}
		else{
			requirment[divid-1].options[2].removeAttribute("disabled");
		}
	}
	
	//after choosing number of radio buttons this function generate inputs for radio button labels 
	function createradiolabels(rbuttonslabels, divid){
		var k=divid - 1;
		var bv = document.getElementsByClassName("buttonsvalues");
		bv[k].innerHTML= "";
		bv[k].style.display= "inline";
			for(var i = 1; i <= rbuttonslabels.value; i++){
				var rblabel=document.createElement("input");
					rblabel.type="text";
					rblabel.className="rblabel";
					bv[k].appendChild(rblabel);
					var br=document.createElement("br");
					bv[k].appendChild(br);
			}
	}

	//function that saves formular to database
	function saveformular(searchadminbase){
		var label = document.getElementsByClassName("label");
		var inputtype = document.getElementsByClassName("inputtype");
		var rbn = document.getElementsByClassName("radiobuttonsnumber");
		var requirment = document.getElementsByClassName("requirment");
		var rblabel = document.getElementsByClassName("rblabel");
		
		var form2 =[
			{name: searchadminbase}
		];
		var fill = {rb: 0, label:"", inputtype:"", ifrb:null, requirment:""};
	
		var mbv = Number(0);
		for(var i=1; i < inputid; i++){			
			form2[i]=Object.create(fill);
			form2[i].rb = i;
			form2[i].label = label[i-1].value;
			form2[i].inputtype = inputtype[i-1][inputtype[i-1].selectedIndex].value;
			if(inputtype[i-1].value == "Radiobuttons"){
				var rbv=[];
				var val=rbn[i-1][rbn[i-1].selectedIndex].value;
				console.log(val);
				for(var j=0; j < val; j++){
					rbv[j]=rblabel[j+mbv].value;
				}
				mbv = Number(mbv) + Number(val);
				form2[i].ifrb=rbv;
			}
			form2[i].requirment=requirment[i-1][requirment[i-1].selectedIndex].value;
		}
		
		var l;
		for (l = 0; l < adminbase.length; l++){
			if(adminbase[l][0].name == searchadminbase){
				adminbase[l]=form2;
				break;
			}
		}
		if(l == adminbase.length){
			adminbase.push(form2);
		}	
	
		console.log("Formular saved");
		log();
	}
	
	function log(){
		for(var s=0; s<adminbase.length; s++){
			console.log(adminbase[s]);
		}
		for(var z=0; z<formularbase.length; z++){
			console.log(formularbase[z]);
		}
	}
	
	//functions for Formular tab
	
	var filedformular=[
        {name:"Some existing formular", version: 1},                                
       	{Label: "Label1"},    
       	{Label: "Label2"},
		{Label: false},  
		{Label: 24},
		{Label: "Radio lb3"},
		{Label: "Label6"},
		
	];
	var filedformular2=[
        {name:"Another one", version: 1},                                
       	{Label: "Label1"},    
       	{Label: "RBL1"},
		{Label: true},  
		{Label: 42},
		{Label: "Label5"},
	];
	var formularbase = [filedformular];
	formularbase.push(filedformular2);
	
	//reads admin database and show existing formulars as option to choose
	function refreshformularselect(){
		var selectformular = document.getElementById("SelectExistingFormular");
		selectformular.innerHTML="";
		var option = document.createElement("option");
				option.text = "Choose here";
				option.value = "";
				option.setAttribute("hidden", true);
				option.setAttribute("disabled", true);
				option.setAttribute("selected", true);
				selectformular.appendChild(option);
		var i;
		for(i=0; i<adminbase.length; i++){
			var option1 = document.createElement("option");
				option1.text = adminbase[i][0].name;
				option1.value = adminbase[i][0].name;
				selectformular.appendChild(option1);
		}
	}
	
	//search formular database by name and version and if formular exist generate page layout with filled fields else just generate page layout based on template
	function generateformular(formularname, version){
		if(version==""){ window.alert("Please type version");}
		else{
			var template;
			for(var j=0; j<adminbase.length; j++){
				if(adminbase[j][0].name==formularname){
					template=adminbase[j];
					break;
				}
			}
			document.getElementById("formularbody").style.display="inline";
			document.getElementById("formularform").innerHTML="";
			//document.getElementById("buttonsave").style.display="inline";
			var i;
			for (i = 0; i < formularbase.length; i++){
				if(formularbase[i][0].name == formularname  && formularbase[i][0].version == version){
					console.log("Formular exist");
					oldformular(template, formularbase[i]);
					break;
				}
			}
			if(i == formularbase.length){
				for(var i=1; i<template.length; i++){
					formularlayout(i, template[i]);
				}
			}
			var destination= document.getElementById("formularform");
				var submit= document.createElement("input");
				submit.type="submit";
				submit.id="buttonsave";
				submit.value="Save";
				destination.appendChild(submit);
		}
	}
	
	/*<div id="test">
		Label 1: <input type="text" required> <br>
		Label 2: <input type="text"><br>
		Label 3: <input type="check"><br>
		Label 4: <input type="text"><br>
		Label 5: 
  			<input type="radio" id="Radiobutton1" name="drone" checked>
 			<label for="Radiobutton1">Radio button 1</label>
			<br>
			<input type="radio" id="Radiobutton2" name="drone" >
			<label for="Radiobutton2">Radio button 2</label>
			<br>
  			<input type="radio" id="Radiobutton3" name="drone" >
		 	<label for="Radiobutton3">Radio button 3</label>
			<br>
		Label 6: <input type="text"> */
	
	//generate page layout based on template from adminbase and fill it with values from formular base
	function oldformular(template, existformular){
		for(var i=1; i<template.length; i++){
			formularlayout(i, template[i]);
		}
		for(var j=1; j<existformular.length; j++){
			if(template[j].inputtype == "Textbox"){
				var input=document.getElementById(template[j].label);
				input.value=existformular[j].Label;
			}
			else if(template[j].inputtype == "Checkbox"){
				var input=document.getElementById(template[j].label);
				if(existformular[j].Label){
					input.setAttribute("checked", true);
				}
			}
			else{
				var input=document.getElementById(existformular[j].Label);
				input.setAttribute("checked", true);
			}
		}
	}
	
	//generate layout for elements individualy
	function formularlayout(element, template){
		
		var formularf=document.getElementById("formularform");
			var br=document.createElement("br");
			var div=document.createElement("div");
			div.id=element;
			var label=template.label;
			
		if(template.requirment == "Mandatory"){
			label+="* :";	
		}
		else{
			label+=" :"
		}
		div.innerHTML+=label;
		
		if(template.inputtype == "Textbox"){
			var input=document.createElement("input");
			input.id=template.label;
			if(template.requirment == "Numeric"){
				input.type="number";
			}
			else{
				input.type="text";
			}
			if(template.requirment == "Mandatory"){
				input.setAttribute("required", true);
			}
			div.appendChild(input);
		}
		else if(template.inputtype == "Checkbox"){
			var input=document.createElement("input");
			input.id=template.label;
			input.type="checkbox";
			if(template.requirment == "Mandatory"){
				input.setAttribute("required", true);
			}
			div.appendChild(input);
		}
		else{
			var div2=document.createElement("div");
			div2.className="formularradiobuttons";
			var input=[];
			var rblabel=[];
			for(var i=0; i<template.ifrb.length; i++){
				input[i]=document.createElement("input");
				rblabel[i]= document.createElement("LABEL");
				input[i].id=template.ifrb[i];
				input[i].name="radiobutton"+element;
				input[i].type="radio";
				if(template.requirment == "Mandatory"){
					input[i].setAttribute("required", true);
				}
				rblabel[i].setAttribute("for", input[i].id);
				rblabel[i].innerHTML=template.ifrb[i];
				div2.appendChild(input[i]);
				div2.appendChild(rblabel[i]);
				div2.appendChild(document.createElement("br"));
			}
				
			div.appendChild(div2);
		}
		
		formularf.appendChild(div);
		formularf.appendChild(br);
		
	}
	
	//saving filled form to formular database or updating existing one 
	function formularsave(templatename, version){
		var fform =[
			{name: templatename, version: Number(version)}
		];
		var fill = {Label:""};
		
		var template;
		for(var j=0; j<adminbase.length; j++){
			if(adminbase[j][0].name==templatename){
				template=adminbase[j];
				break;
			}
		}
		
		for(var i=1; i<template.length; i++){
			fform[i] = Object.create(fill);
			if(template[i].inputtype == "Textbox"){
				var input = document.getElementById(template[i].label);
				fform[i].Label=input.value;
			}
			else if(template[i].inputtype == "Checkbox"){
				var input = document.getElementById(template[i].label);
				if(input.checked)
					fform[i].Label=true;
				else
					fform[i].Label=false;
			}
			else{
				var input = document.formularform["radiobutton"+i];
				for (var j = 0; j < input.length; j++){ 
					if (input[j].checked){
						fform[i].Label=input[j].id;
						break;
					}		
				}
			}
		}

		var k;
		for (k = 0; k < formularbase.length; k++){
			if(formularbase[k][0].name == templatename  && formularbase[k][0].version == version){
				formularbase[k]=fform;
				break;
			}
		}
		if(k == formularbase.length){
			formularbase.push(fform);
		}
		
		log();
	}
	
	</script>

<!-- Tab links -->
<div class="tab">
	<button class="tablinks" onclick="openTab(event, 'Administration')">Administration</button>
	<button class="tablinks" onclick="openTab(event, 'Formular'), refreshformularselect()">Formular</button>
</div>

<!-- Tab content -->
<div id="Administration" class="tabcontent">
	<div id="adminsearch">
		Formular name:
		<input id="formname" type="text" onkeyup="adminsearchenter()" required>
		<input type="submit" value="Search" onClick="adminsearch(formname.value)">
	</div>
	<br>
	<div id="adminbody"> </div>
	<br>
	<div id="savebutton">
		<input type="submit" onClick="saveformular(formname.value)" value="Save">
	</div>
</div>	

<div id="Formular" class="tabcontent">
	<div id="formularsearch">
		Formular name:
		<select id="SelectExistingFormular">
		</select>
		Version
		<input id="version" type="number">
		<input type="submit" onClick="generateformular(SelectExistingFormular.value, version.value)" value="Load">
	</div>
	<br>
	<div id="formularbody">
		<form name="formularform" id="formularform" action="JavaScript:formularsave(SelectExistingFormular.value,version.value)">
			
		</form>
		<br>
	</div>
	
</div>
</body>
</html>


<!--
	<div id="template">
		<input type="text" id="label" class="" value="">
		<select id="inputtype" class="" onchange="createradiolabel(this, 'template')">
			<option value="textbox">Textbox</option>
			<option value="checkbox">Checkbox</option>
			<option value="radiobuttons">Radio buttons</option>
		</select>
		<select id="radiobuttonsnumber" class="">
			<option value="" selected disabled hidden></option>
			<option value="2">2</option>
			<option value="3">3</option>
			<option value="4">4</option>
			<option value="5">5</option>
		</select>
		<select id="requirments" class="">
			<option value="none">None</option>
			<option value="mandatory">Mandatory</option>
			<option value="numeric">Numeric</option>
		</select>

		<input type="submit" id="newdivbutton" class="" onclick="newdiv()" value="+">
	
		<br>
		
		<div id="buttonsvalues" class=""> </div>		
	
		</div>
	</div>

	<div id="test">
		Label 1: <input type="text" required> <br>
		Label 2: <input type="text"><br>
		Label 3: <input type="checkbox"><br>
		Label 4: <input type="text"><br>
		Label 5: 
  			<input type="radio" id="Radiobutton1" name="drone" checked>
 			<label for="Radiobutton1">Radio button 1</label>
			<br>
			<input type="radio" id="Radiobutton2" name="drone">
			<label for="Radiobutton2" value="">Radio button 2</label>
			<br>
  			<input type="radio" id="Radiobutton3" name="drone" >
		 	<label for="Radiobutton3">Radio button 3</label>
			<br>
		Label 6: <input type="text">	
	</div>
-->